<div style="text-align:center; margin:20px;">
  <h2>Login to Access Tests</h2>
  <input id="username" placeholder="Username (dev)" style="padding:10px; margin:5px;">
  <input id="password" type="password" placeholder="Password (password123)" style="padding:10px; margin:5px;">
  <button onclick="login()" style="padding:10px 20px; background:#007bff; color:white; border:none; cursor:pointer;">Login</button>
  <p id="message" style="color:red;"></p>
</div>

<script>
  function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    })
    .then(res => res.json())
    .then(data => {
      if (data.token) {
        localStorage.setItem('token', data.token);
        document.getElementById('message').style.color = 'green';
        document.getElementById('message').innerText = 'Login success! Tests loading...';
        loadTests();  // tests reload kar
      } else {
        document.getElementById('message').innerText = data.error;
      }
    })
    .catch(err => console.log(err));
  }

  // Tests load karne ka function (token ke saath)
  function loadTests() {
    const token = localStorage.getItem('token');
    if (!token) return;

    fetch('/api/tests', {
      headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(res => res.json())
    .then(tests => {
      const container = document.getElementById('tests');
      container.innerHTML = '';  // clear pehle
      tests.forEach(test => {
        const card = document.createElement('div');
        card.className = 'test-card';
        card.innerHTML = `
          <h3>${test.name}</h3>
          <p>Date: ${test.date} | Questions: ${test.questions}</p>
          <button onclick="startTest('${test.id}')">Start Test</button>
        `;
        container.appendChild(card);
      });
    })
    .catch(err => console.log('Tests load error:', err));
  }

  // Page load pe agar token hai toh auto load
  window.onload = () => {
    if (localStorage.getItem('token')) loadTests();
  };
</script>
